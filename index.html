<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­æœ—è¯»æ‰“å¡åŠ©æ‰‹</title>
    <style>
        :root {
            --primary: #10B981;
            --primary-light: #A7F3D0;
            --success: #059669;
            --warning: #F59E0B;
            --error: #EF4444;
            --background: #F0FDF4;
            --surface: #FFFFFF;
            --text: #064E3B;
            --text-light: #6B7280;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: var(--surface);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.8);
            width: 100%;
        }

        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1.8em;
        }

        .subtitle {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .goal-card {
            background: linear-gradient(135deg, var(--primary-light) 0%, #E6F3FF 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 4px solid var(--primary);
        }

        .goal-card h3 {
            margin-top: 0;
            color: var(--text);
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .goal-card p {
            margin: 8px 0;
        }

        .keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .keyword {
            background: rgba(255, 255, 255, 0.7);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            color: var(--primary);
            font-weight: 500;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }

        input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #E2E8F0;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--surface);
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .btn {
            display: block;
            width: 100%;
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #0DA271;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-recording {
            background-color: var(--error);
            animation: pulse 1.5s infinite;
        }

        .btn-secondary {
            background-color: var(--surface);
            color: var(--text);
            border: 1px solid #E2E8F0;
        }

        .btn-secondary:hover {
            background-color: #F7FAFC;
            border-color: var(--primary-light);
        }

        .recording-status {
            text-align: center;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            display: none;
        }

        .recording-active {
            background-color: #FEF3C7;
            border: 1px solid var(--warning);
            color: var(--warning);
            display: block;
        }

        .processing-status {
            background-color: #E0F2FE;
            border: 1px solid #0EA5E9;
            color: #0C4A6E;
            display: block;
        }

        .audio-playback {
            margin: 20px 0;
            text-align: center;
            display: none;
        }

        .audio-playback audio {
            width: 100%;
            margin: 10px 0;
        }

        .recognition-result {
            margin: 20px 0;
            padding: 20px;
            border-radius: 12px;
            background-color: #F8FAFC;
            border: 1px solid #E2E8F0;
            display: none;
        }

        .result-show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .keyword-match {
            background-color: var(--success);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
        }

        #result {
            margin-top: 25px;
            padding: 20px;
            border-radius: 12px;
            display: none;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        .success {
            background-color: #F0FFF4;
            border: 1px solid #9AE6B4;
            color: #2F855A;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        @media (max-width: 600px) {
            body {
                padding: 15px;
            }
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¿ è‹±è¯­æœ—è¯»æ‰“å¡</h1>
        <p class="subtitle">è®°å½•æ¯ä¸€å¤©çš„è¿›æ­¥ï¼Œé‡è§æ›´å¥½çš„è‡ªå·±</p>
        
        <div class="goal-card">
            <h3>ğŸ“š ä»Šæ—¥æœ—è¯»ææ–™</h3>
            <p><em>"The future belongs to those who believe in the beauty of their dreams."</em> â€” Eleanor Roosevelt</p>
            <div class="keywords">
                <span class="keyword">future</span>
                <span class="keyword">believe</span>
                <span class="keyword">beauty</span>
                <span class="keyword">dreams</span>
            </div>
        </div>

        <div class="input-group">
            <label for="sentenceCount">ğŸ“Š ä»Šæ—¥æœ—è¯»å¥å­æ•°ï¼š</label>
            <input type="number" id="sentenceCount" value="1" min="1">
        </div>

        <!-- å½•éŸ³çŠ¶æ€æ˜¾ç¤º -->
        <div id="recordingStatus" class="recording-status">
            <div>â— å½•éŸ³ä¸­... <span id="recordingTimer">0</span>ç§’</div>
            <small>è¯·å¼€å§‹æœ—è¯»ä¸Šé¢çš„è‹±æ–‡å¥å­</small>
        </div>

        <!-- å¤„ç†çŠ¶æ€ -->
        <div id="processingStatus" class="recording-status processing-status">
            <div>â³ æ­£åœ¨åˆ†ææ‚¨çš„å‘éŸ³...</div>
            <small>è¯·ç¨ç­‰ï¼Œæ­£åœ¨å°†è¯­éŸ³è½¬æ¢ä¸ºæ–‡å­—</small>
        </div>

        <!-- å½•éŸ³æ’­æ”¾ -->
        <div id="audioPlayback" class="audio-playback">
            <h4>ğŸµ æ‚¨çš„å½•éŸ³</h4>
            <audio id="audioPlayer" controls></audio>
        </div>

        <!-- è¯­éŸ³è¯†åˆ«ç»“æœ -->
        <div id="recognitionResult" class="recognition-result">
            <h4>ğŸ“ è¯†åˆ«ç»“æœ</h4>
            <p id="recognizedText"></p>
            <div id="keywordAnalysis" style="margin-top: 10px;"></div>
        </div>

        <button class="btn btn-primary" id="recordBtn">ğŸ¤ å¼€å§‹å½•éŸ³æœ—è¯»</button>
        <button class="btn btn-secondary" id="manualBtn">âœï¸ æ‰‹åŠ¨å®Œæˆæ‰“å¡</button>
        <button class="btn btn-primary" id="submitBtn" style="display: none;">âœ… å®Œæˆæ‰“å¡</button>

        <div id="result">
            <!-- æ‰“å¡ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
        </div>
    </div>

    <script>
        // å½•éŸ³ç›¸å…³å˜é‡
        let mediaRecorder;
        let audioChunks = [];
        let recordingTimer;
        let recordingSeconds = 0;
        let isRecording = false;

        // ç›®æ ‡å…³é”®è¯
        const targetKeywords = ['future', 'believe', 'beauty', 'dreams'];
        const targetSentence = "The future belongs to those who believe in the beauty of their dreams";

        // DOM å…ƒç´ 
        const recordBtn = document.getElementById('recordBtn');
        const manualBtn = document.getElementById('manualBtn');
        const submitBtn = document.getElementById('submitBtn');
        const recordingStatus = document.getElementById('recordingStatus');
        const processingStatus = document.getElementById('processingStatus');
        const audioPlayback = document.getElementById('audioPlayback');
        const audioPlayer = document.getElementById('audioPlayer');
        const recognitionResult = document.getElementById('recognitionResult');
        const recognizedText = document.getElementById('recognizedText');
        const keywordAnalysis = document.getElementById('keywordAnalysis');
        const recordingTimerDisplay = document.getElementById('recordingTimer');
        const resultDiv = document.getElementById('result');

        // å¼€å§‹å½•éŸ³
        recordBtn.addEventListener('click', async function() {
            if (!isRecording) {
                try {
                    // è¯·æ±‚éº¦å…‹é£æƒé™
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // åˆ›å»º MediaRecorder å®ä¾‹
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];
                    
                    // æ”¶é›†éŸ³é¢‘æ•°æ®
                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };
                    
                    // å½•éŸ³å®Œæˆ
                    mediaRecorder.onstop = async () => {
                        // æ˜¾ç¤ºå¤„ç†çŠ¶æ€
                        processingStatus.style.display = 'block';
                        
                        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        
                        // æ˜¾ç¤ºå½•éŸ³æ’­æ”¾å™¨
                        audioPlayer.src = audioUrl;
                        audioPlayback.style.display = 'block';
                        
                        try {
                            // è¿›è¡Œè¯­éŸ³è¯†åˆ«
                            const recognizedTextContent = await speechRecognition(audioBlob);
                            
                            // åˆ†æå…³é”®è¯åŒ¹é…
                            const analysis = analyzeKeywords(recognizedTextContent, targetKeywords);
                            
                            // æ˜¾ç¤ºè¯†åˆ«ç»“æœ
                            displayRecognitionResult(recognizedTextContent, analysis);
                            
                            // å¯ç”¨æäº¤æŒ‰é’®
                            submitBtn.style.display = 'block';
                            
                        } catch (error) {
                            console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', error);
                            recognizedText.innerHTML = 'âŒ è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–ä½¿ç”¨æ‰‹åŠ¨æ‰“å¡';
                            recognitionResult.classList.add('result-show');
                        }
                        
                        // éšè—å¤„ç†çŠ¶æ€
                        processingStatus.style.display = 'none';
                        
                        // åœæ­¢æ‰€æœ‰éŸ³è½¨
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    // å¼€å§‹å½•éŸ³
                    mediaRecorder.start();
                    isRecording = true;
                    
                    // æ›´æ–°UI
                    recordBtn.textContent = 'â¹ï¸ åœæ­¢å½•éŸ³';
                    recordBtn.classList.add('btn-recording');
                    recordingStatus.className = 'recording-status recording-active';
                    
                    // é‡ç½®ä¹‹å‰çš„ç»“æœ
                    recognitionResult.classList.remove('result-show');
                    submitBtn.style.display = 'none';
                    
                    // å¼€å§‹è®¡æ—¶å™¨
                    recordingSeconds = 0;
                    recordingTimer = setInterval(() => {
                        recordingSeconds++;
                        recordingTimerDisplay.textContent = recordingSeconds;
                    }, 1000);
                    
                } catch (error) {
                    console.error('å½•éŸ³é”™è¯¯:', error);
                    alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·ç¡®ä¿å·²æˆäºˆå½•éŸ³æƒé™ã€‚');
                }
            } else {
                // åœæ­¢å½•éŸ³
                mediaRecorder.stop();
                isRecording = false;
                
                // æ›´æ–°UI
                recordBtn.textContent = 'ğŸ¤ å¼€å§‹å½•éŸ³æœ—è¯»';
                recordBtn.classList.remove('btn-recording');
                recordingStatus.className = 'recording-status';
                
                // åœæ­¢è®¡æ—¶å™¨
                clearInterval(recordingTimer);
            }
        });

        // è¯­éŸ³è¯†åˆ«å‡½æ•°ï¼ˆä½¿ç”¨æµè§ˆå™¨åŸç”ŸAPIï¼‰
        function speechRecognition(audioBlob) {
            return new Promise((resolve, reject) => {
                // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³è¯†åˆ«
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    // æ¨¡æ‹Ÿè¯†åˆ«ç»“æœï¼ˆç”¨äºæ¼”ç¤ºï¼‰
                    setTimeout(() => {
                        const mockResults = [
                            "the future belongs to those who believe in the beauty of their dreams",
                            "the future belongs to those who believe in beauty of dreams", 
                            "future belongs those who believe in beauty dreams",
                            "the future belong to those who believe in the beauty of their dream"
                        ];
                        const randomResult = mockResults[Math.floor(Math.random() * mockResults.length)];
                        resolve(randomResult);
                    }, 2000);
                    return;
                }

                // åˆ›å»ºè¯­éŸ³è¯†åˆ«å®ä¾‹
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';

                // å¤„ç†è¯†åˆ«ç»“æœ
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    resolve(transcript.toLowerCase());
                };

                recognition.onerror = (event) => {
                    reject(new Error(`è¯­éŸ³è¯†åˆ«é”™è¯¯: ${event.error}`));
                };

                // å¼€å§‹è¯†åˆ«ï¼ˆè¿™é‡Œéœ€è¦å°†Blobè½¬æ¢ä¸ºå¯è¯†åˆ«çš„æ ¼å¼ï¼‰
                // æ³¨æ„ï¼šå®é™…éƒ¨ç½²æ—¶éœ€è¦åç«¯å¤„ç†æˆ–ä½¿ç”¨æ”¯æŒBlobçš„API
                // è¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿç»“æœä½œä¸ºæ¼”ç¤º
                setTimeout(() => {
                    const mockResults = [
                        "the future belongs to those who believe in the beauty of their dreams",
                        "the future belongs to those who believe in beauty of dreams"
                    ];
                    resolve(mockResults[Math.floor(Math.random() * mockResults.length)]);
                }, 1500);
            });
        }

        // åˆ†æå…³é”®è¯åŒ¹é…
        function analyzeKeywords(recognizedText, keywords) {
            const foundKeywords = [];
            const missingKeywords = [];
            
            keywords.forEach(keyword => {
                if (recognizedText.includes(keyword)) {
                    foundKeywords.push(keyword);
                } else {
                    missingKeywords.push(keyword);
                }
            });
            
            const accuracy = (foundKeywords.length / keywords.length) * 100;
            
            return {
                found: foundKeywords,
                missing: missingKeywords,
                accuracy: accuracy.toFixed(1),
                total: keywords.length,
                foundCount: foundKeywords.length
            };
        }

        // æ˜¾ç¤ºè¯†åˆ«ç»“æœ
        function displayRecognitionResult(text, analysis) {
            // é«˜äº®æ˜¾ç¤ºè¯†åˆ«åˆ°çš„å…³é”®è¯
            let highlightedText = text;
            analysis.found.forEach(keyword => {
                const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                highlightedText = highlightedText.replace(regex, `<span class="keyword-match">${keyword}</span>`);
            });
            
            recognizedText.innerHTML = highlightedText;
            
            // æ˜¾ç¤ºåˆ†æç»“æœ
            keywordAnalysis.innerHTML = `
                <div style="margin-top: 10px;">
                    <strong>å…³é”®è¯åˆ†æï¼š</strong><br>
                    âœ… è¯†åˆ«åˆ°: ${analysis.found.join(', ') || 'æ— '}<br>
                    ${analysis.missing.length > 0 ? `âŒ æœªè¯†åˆ«: ${analysis.missing.join(', ')}` : 'ğŸ‰ æ‰€æœ‰å…³é”®è¯éƒ½å·²è¯†åˆ«ï¼'}<br>
                    <strong>å‡†ç¡®ç‡: ${analysis.accuracy}%</strong> (${analysis.foundCount}/${analysis.total})
                </div>
            `;
            
            recognitionResult.classList.add('result-show');
        }

        // å®Œæˆæ‰“å¡ï¼ˆå½•éŸ³æ¨¡å¼ï¼‰
        submitBtn.addEventListener('click', function() {
            const count = document.getElementById('sentenceCount').value;
            
            resultDiv.innerHTML = `
                <h3>âœ… æ™ºèƒ½æ‰“å¡æˆåŠŸï¼</h3>
                <p>è®°å½•äº† <strong>${count}</strong> ä¸ªå¥å­çš„æœ—è¯»ã€‚</p>
                <p><strong>å½•éŸ³æ—¶é•¿ï¼š</strong>${recordingSeconds}ç§’</p>
                <p><strong>è¯­éŸ³è¯†åˆ«ï¼š</strong>å·²å¯ç”¨</p>
                <p><em>ï¼ˆä¸‹ä¸€æ­¥ï¼šæ·»åŠ å­¦ä¹ æ•°æ®ç»Ÿè®¡ï¼‰</em></p>
            `;
            resultDiv.className = 'success';
            resultDiv.style.display = 'block';
            
            // é‡ç½®çŠ¶æ€
            submitBtn.style.display = 'none';
        });

        // æ‰‹åŠ¨æ‰“å¡åŠŸèƒ½
        manualBtn.addEventListener('click', function() {
            const count = document.getElementById('sentenceCount').value;
            
            resultDiv.innerHTML = `
                <h3>âœ… æ‰“å¡æˆåŠŸï¼</h3>
                <p>è®°å½•äº† <strong>${count}</strong> ä¸ªå¥å­çš„æœ—è¯»ã€‚</p>
                <p><em>ï¼ˆæ‰‹åŠ¨æ‰“å¡æ¨¡å¼ï¼‰</em></p>
            `;
            resultDiv.className = 'success';
            resultDiv.style.display = 'block';
        });

        // è¾“å…¥æ¡†å›è½¦é”®æ”¯æŒ
        document.getElementById('sentenceCount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                manualBtn.click();
            }
        });
    </script>
</body>
</html>
