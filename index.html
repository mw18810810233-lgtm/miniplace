<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šç”¨æˆ·è‹±è¯­è·Ÿè¯»ç³»ç»Ÿ</title>
    <style>
        :root {
            --primary: #10B981;
            --primary-light: #A7F3D0;
            --success: #059669;
            --warning: #F59E0B;
            --error: #EF4444;
            --background: #F0FDF4;
            --surface: #FFFFFF;
            --text: #064E3B;
            --text-light: #6B7280;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            background: var(--surface);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
        }

        h1 {
            color: var(--primary);
            text-align: center;
            margin-bottom: 10px;
        }

        h2 {
            color: var(--primary);
            margin: 25px 0 15px 0;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 8px;
        }

        .subtitle {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        /* ç”¨æˆ·é€‰æ‹©ç•Œé¢ */
        .user-selection {
            text-align: center;
            padding: 40px;
        }

        .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .user-card {
            border: 3px solid #E2E8F0;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .user-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .user-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary-light) 0%, #E6F3FF 100%);
        }

        .user-avatar {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .user-progress {
            font-size: 12px;
            color: var(--text-light);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0DA271;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--surface);
            color: var(--text);
            border: 1px solid #E2E8F0;
        }

        .btn-secondary:hover {
            background-color: #F7FAFC;
        }

        /* ç”¨æˆ·ç®¡ç† */
        .user-management {
            background: #F8FAFC;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input, .form-select {
            width: 100%;
            max-width: 300px;
            padding: 10px;
            border: 1px solid #E2E8F0;
            border-radius: 8px;
            font-size: 14px;
        }

        /* è¿›åº¦ç»Ÿè®¡ */
        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .progress-card {
            background: white;
            border: 1px solid #E2E8F0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .progress-number {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .progress-label {
            font-size: 14px;
            color: var(--text-light);
        }

        /* éšè—å†…å®¹åŒºåŸŸ */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* åŠ¨ç”»å¡ç‰‡ */
        .animation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .animation-card {
            border: 1px solid #E2E8F0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            background: white;
        }

        .animation-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .animation-thumbnail {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .animation-info {
            padding: 15px;
        }

        .animation-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .animation-meta {
            font-size: 12px;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .user-progress-bar {
            height: 6px;
            background: #E2E8F0;
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }

        .user-progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .user-grid {
                grid-template-columns: 1fr;
            }
            
            .progress-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ç”¨æˆ·é€‰æ‹©ç•Œé¢ -->
    <div id="user-selection" class="container user-selection">
        <h1>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å¤šç”¨æˆ·è‹±è¯­è·Ÿè¯»ç³»ç»Ÿ</h1>
        <p class="subtitle">è¯·é€‰æ‹©è¦ä½¿ç”¨çš„ç”¨æˆ·ï¼Œæˆ–åˆ›å»ºæ–°ç”¨æˆ·</p>

        <div class="user-management">
            <h3>æ·»åŠ æ–°ç”¨æˆ·</h3>
            <div class="form-group">
                <input type="text" id="newUserName" class="form-input" placeholder="è¾“å…¥ç”¨æˆ·å§“å">
                <select id="newUserAvatar" class="form-select">
                    <option value="ğŸ‘¦">ç”·å­© ğŸ‘¦</option>
                    <option value="ğŸ‘§">å¥³å­© ğŸ‘§</option>
                    <option value="ğŸ»">å°ç†Š ğŸ»</option>
                    <option value="ğŸ°">å°å…” ğŸ°</option>
                    <option value="ğŸ¯">å°è™ ğŸ¯</option>
                </select>
                <button class="btn btn-primary" onclick="createNewUser()">åˆ›å»ºç”¨æˆ·</button>
            </div>
        </div>

        <div class="user-grid" id="usersGrid">
            <!-- ç”¨æˆ·å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <button class="btn btn-primary" onclick="startApplication()" id="startBtn" disabled>
            è¿›å…¥å­¦ä¹ ç³»ç»Ÿ
        </button>
    </div>

    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <div id="main-application" class="content-section">
        <div class="container">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                <h1 id="currentUserWelcome">æ¬¢è¿ä½¿ç”¨</h1>
                <button class="btn btn-secondary" onclick="switchUser()">åˆ‡æ¢ç”¨æˆ·</button>
            </div>

            <!-- ç”¨æˆ·è¿›åº¦æ¦‚è§ˆ -->
            <div class="progress-grid">
                <div class="progress-card">
                    <div class="progress-number" id="completedAnimations">0</div>
                    <div class="progress-label">å·²å®ŒæˆåŠ¨ç”»</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="totalSentences">0</div>
                    <div class="progress-label">è·Ÿè¯»å¥å­æ•°</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="averageAccuracy">0%</div>
                    <div class="progress-label">å¹³å‡å‡†ç¡®ç‡</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="learningTime">0min</div>
                    <div class="progress-label">å­¦ä¹ æ—¶é—´</div>
                </div>
            </div>

            <!-- åŠ¨ç”»åº“ -->
            <h2>ğŸ¬ é€‰æ‹©åŠ¨ç”»å¼€å§‹ç»ƒä¹ </h2>
            <div class="animation-grid" id="animationLibrary">
                <!-- åŠ¨ç”»å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨é”®å
        const USERS_STORAGE_KEY = 'english_learning_users';
        const ANIMATIONS_STORAGE_KEY = 'english_animation_library';
        const PROGRESS_STORAGE_KEY = 'user_learning_progress';

        // å½“å‰é€‰ä¸­çš„ç”¨æˆ·
        let currentUser = null;

        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            loadUsers();
            renderUserGrid();
        }

        // åŠ è½½ç”¨æˆ·æ•°æ®
        function loadUsers() {
            const stored = localStorage.getItem(USERS_STORAGE_KEY);
            if (!stored) {
                // åˆå§‹åŒ–ç¤ºä¾‹ç”¨æˆ·
                const defaultUsers = {
                    'user_1': {
                        id: 'user_1',
                        name: 'å°æ˜',
                        avatar: 'ğŸ‘¦',
                        createdAt: new Date().toISOString(),
                        color: '#10B981'
                    },
                    'user_2': {
                        id: 'user_2',
                        name: 'å°çº¢',
                        avatar: 'ğŸ‘§',
                        createdAt: new Date().toISOString(),
                        color: '#EF4444'
                    }
                };
                localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(defaultUsers));
            }
        }

        // è·å–æ‰€æœ‰ç”¨æˆ·
        function getAllUsers() {
            const stored = localStorage.getItem(USERS_STORAGE_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        // æ¸²æŸ“ç”¨æˆ·ç½‘æ ¼
        function renderUserGrid() {
            const users = getAllUsers();
            const container = document.getElementById('usersGrid');
            
            if (Object.keys(users).length === 0) {
                container.innerHTML = '<p>è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•ç”¨æˆ·</p>';
                return;
            }
            
            let html = '';
            Object.values(users).forEach(user => {
                const progress = getUserProgress(user.id);
                html += `
                    <div class="user-card" onclick="selectUser('${user.id}')" id="user-${user.id}">
                        <div class="user-avatar">${user.avatar}</div>
                        <div class="user-name">${user.name}</div>
                        <div class="user-progress">
                            å·²å®Œæˆ ${progress.completedAnimations} ä¸ªåŠ¨ç”»<br>
                            å¹³å‡å‡†ç¡®ç‡ ${progress.averageAccuracy}%
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // é€‰æ‹©ç”¨æˆ·
        function selectUser(userId) {
            // æ›´æ–°UIçŠ¶æ€
            document.querySelectorAll('.user-card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(`user-${userId}`).classList.add('active');
            
            currentUser = userId;
            document.getElementById('startBtn').disabled = false;
        }

        // åˆ›å»ºæ–°ç”¨æˆ·
        function createNewUser() {
            const name = document.getElementById('newUserName').value.trim();
            const avatar = document.getElementById('newUserAvatar').value;
            
            if (!name) {
                alert('è¯·è¾“å…¥ç”¨æˆ·å§“å');
                return;
            }
            
            const users = getAllUsers();
            const userId = 'user_' + Date.now();
            
            // ç”¨æˆ·é¢œè‰²è½®æ¢
            const colors = ['#10B981', '#EF4444', '#3B82F6', '#8B5CF6', '#F59E0B'];
            const color = colors[Object.keys(users).length % colors.length];
            
            users[userId] = {
                id: userId,
                name: name,
                avatar: avatar,
                createdAt: new Date().toISOString(),
                color: color
            };
            
            localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('newUserName').value = '';
            
            // é‡æ–°æ¸²æŸ“ç”¨æˆ·ç½‘æ ¼
            renderUserGrid();
            
            alert(`âœ… ç”¨æˆ· ${name} åˆ›å»ºæˆåŠŸï¼`);
        }

        // å¯åŠ¨åº”ç”¨
        function startApplication() {
            if (!currentUser) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç”¨æˆ·');
                return;
            }
            
            // åˆ‡æ¢ç•Œé¢
            document.getElementById('user-selection').style.display = 'none';
            document.getElementById('main-application').classList.add('active');
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            const users = getAllUsers();
            const user = users[currentUser];
            document.getElementById('currentUserWelcome').textContent = `æ¬¢è¿ï¼Œ${user.name}ï¼${user.avatar}`;
            
            // åŠ è½½ç”¨æˆ·æ•°æ®
            loadUserData();
        }

        // åˆ‡æ¢ç”¨æˆ·
        function switchUser() {
            document.getElementById('main-application').classList.remove('active');
            document.getElementById('user-selection').style.display = 'block';
            currentUser = null;
            document.getElementById('startBtn').disabled = true;
        }

        // è·å–ç”¨æˆ·è¿›åº¦
        function getUserProgress(userId) {
            const stored = localStorage.getItem(PROGRESS_STORAGE_KEY);
            const allProgress = stored ? JSON.parse(stored) : {};
            const userProgress = allProgress[userId] || {
                completedAnimations: 0,
                totalSentences: 0,
                averageAccuracy: 0,
                learningTime: 0,
                animations: {}
            };
            
            return userProgress;
        }

        // ä¿å­˜ç”¨æˆ·è¿›åº¦
        function saveUserProgress(userId, progress) {
            const stored = localStorage.getItem(PROGRESS_STORAGE_KEY);
            const allProgress = stored ? JSON.parse(stored) : {};
            allProgress[userId] = progress;
            localStorage.setItem(PROGRESS_STORAGE_KEY, JSON.stringify(allProgress));
        }

        // åŠ è½½ç”¨æˆ·æ•°æ®
        function loadUserData() {
            const progress = getUserProgress(currentUser);
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            document.getElementById('completedAnimations').textContent = progress.completedAnimations;
            document.getElementById('totalSentences').textContent = progress.totalSentences;
            document.getElementById('averageAccuracy').textContent = progress.averageAccuracy + '%';
            document.getElementById('learningTime').textContent = progress.learningTime + 'min';
            
            // åŠ è½½åŠ¨ç”»åº“
            loadAnimationLibrary();
        }

        // åŠ è½½åŠ¨ç”»åº“
        function loadAnimationLibrary() {
            const stored = localStorage.getItem(ANIMATIONS_STORAGE_KEY);
            const library = stored ? JSON.parse(stored) : {};
            const container = document.getElementById('animationLibrary');
            const userProgress = getUserProgress(currentUser);
            
            if (Object.keys(library).length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; grid-column: 1 / -1; padding: 40px;">
                        <p style="color: var(--text-light); margin-bottom: 20px;">è¿˜æ²¡æœ‰åŠ¨ç”»å†…å®¹</p>
                        <button class="btn btn-primary" onclick="alert('åŠ¨ç”»ä¸Šä¼ åŠŸèƒ½éœ€è¦åœ¨å®Œæ•´ç‰ˆæœ¬ä¸­å®ç°')">
                            ä¸Šä¼ åŠ¨ç”»
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = '';
            Object.values(library).forEach(animation => {
                const userAnimationProgress = userProgress.animations[animation.id] || {
                    completed: false,
                    accuracy: 0,
                    completedSentences: 0,
                    totalSentences: animation.dialogues.length
                };
                
                const progressPercent = userAnimationProgress.totalSentences > 0 
                    ? (userAnimationProgress.completedSentences / userAnimationProgress.totalSentences) * 100 
                    : 0;
                
                html += `
                    <div class="animation-card">
                        <div class="animation-thumbnail">
                            ğŸ¬ ${animation.title}
                        </div>
                        <div class="animation-info">
                            <div class="animation-title">${animation.title}</div>
                            <div class="animation-meta">
                                éš¾åº¦: ${getLevelText(animation.level)} | 
                                å°è¯: ${animation.dialogues.length}å¥
                            </div>
                            <div class="user-progress-bar">
                                <div class="user-progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div style="font-size: 12px; color: var(--text-light);">
                                è¿›åº¦: ${userAnimationProgress.completedSentences}/${userAnimationProgress.totalSentences}
                                ${userAnimationProgress.accuracy > 0 ? `| å‡†ç¡®ç‡: ${userAnimationProgress.accuracy}%` : ''}
                            </div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-primary btn-small" onclick="startPractice('${animation.id}')">
                                    ${userAnimationProgress.completed ? 'ç»§ç»­ç»ƒä¹ ' : 'å¼€å§‹ç»ƒä¹ '}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // å¼€å§‹ç»ƒä¹ 
        function startPractice(animationId) {
            // ä¿å­˜å½“å‰ç»ƒä¹ çš„åŠ¨ç”»ID
            localStorage.setItem('current_practice_animation', animationId);
            localStorage.setItem('current_practice_user', currentUser);
            
            // åœ¨å®é™…å®Œæ•´ç‰ˆæœ¬ä¸­ï¼Œè¿™é‡Œä¼šè·³è½¬åˆ°ç»ƒä¹ ç•Œé¢
            alert(`å¼€å§‹ ${getAllUsers()[currentUser].name} çš„ç»ƒä¹ ï¼\n\nåœ¨å®é™…å®Œæ•´ç‰ˆæœ¬ä¸­ï¼Œè¿™é‡Œä¼šåŠ è½½è·Ÿè¯»ç»ƒä¹ ç•Œé¢ã€‚`);
            
            // æ¨¡æ‹Ÿå®Œæˆç»ƒä¹ ï¼ˆæ¼”ç¤ºç”¨ï¼‰
            simulatePracticeCompletion(animationId);
        }

        // æ¨¡æ‹Ÿç»ƒä¹ å®Œæˆï¼ˆæ¼”ç¤ºç”¨ï¼‰
        function simulatePracticeCompletion(animationId) {
            const userProgress = getUserProgress(currentUser);
            const library = JSON.parse(localStorage.getItem(ANIMATIONS_STORAGE_KEY) || '{}');
            const animation = library[animationId];
            
            if (!userProgress.animations[animationId]) {
                userProgress.animations[animationId] = {
                    completed: false,
                    accuracy: 0,
                    completedSentences: 0,
                    totalSentences: animation.dialogues.length
                };
            }
            
            // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
            const progress = userProgress.animations[animationId];
            progress.completedSentences = Math.min(progress.totalSentences, progress.completedSentences + 2);
            progress.accuracy = Math.min(100, progress.accuracy + Math.random() * 20);
            progress.completed = progress.completedSentences >= progress.totalSentences;
            
            // æ›´æ–°æ€»è¿›åº¦
            userProgress.completedAnimations = Object.values(userProgress.animations).filter(a => a.completed).length;
            userProgress.totalSentences = Object.values(userProgress.animations).reduce((sum, a) => sum + a.completedSentences, 0);
            
            const allAccuracies = Object.values(userProgress.animations)
                .filter(a => a.accuracy > 0)
                .map(a => a.accuracy);
            userProgress.averageAccuracy = allAccuracies.length > 0 
                ? Math.round(allAccuracies.reduce((a, b) => a + b) / allAccuracies.length)
                : 0;
            
            userProgress.learningTime += 5; // å¢åŠ 5åˆ†é’Ÿå­¦ä¹ æ—¶é—´
            
            // ä¿å­˜è¿›åº¦
            saveUserProgress(currentUser, userProgress);
            
            // åˆ·æ–°æ˜¾ç¤º
            loadUserData();
            
            alert(`ç»ƒä¹ å®Œæˆï¼\næ–°å¢2å¥è·Ÿè¯»ï¼Œå½“å‰å‡†ç¡®ç‡: ${progress.accuracy.toFixed(1)}%`);
        }

        // å·¥å…·å‡½æ•°
        function getLevelText(level) {
            const levels = {
                'beginner': 'åˆçº§',
                'intermediate': 'ä¸­çº§', 
                'advanced': 'é«˜çº§'
            };
            return levels[level] || level;
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
