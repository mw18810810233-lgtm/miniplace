<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­è·Ÿè¯»ç»ƒä¹ å¹³å°</title>
    <style>
        :root {
            --primary: #10B981;
            --primary-light: #A7F3D0;
            --success: #059669;
            --warning: #F59E0B;
            --error: #EF4444;
            --background: #F0FDF4;
            --surface: #FFFFFF;
            --text: #064E3B;
            --text-light: #6B7280;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            min-height: 600px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #059669 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        /* è§†é¢‘åº“æ ·å¼ */
        .video-library {
            padding: 30px;
        }

        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .upload-section {
            background: #F8FAFC;
            border: 2px dashed #E2E8F0;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: var(--primary);
            background: #F0FFF4;
        }

        .upload-area {
            cursor: pointer;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .upload-text {
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .video-grid {
            display: grid;
            gap: 25px;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }

        .video-card {
            border: 2px solid #E2E8F0;
            border-radius: 15px;
            overflow: hidden;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3em;
            position: relative;
            overflow: hidden;
        }

        .video-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-duration {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .video-info {
            padding: 20px;
        }

        .video-info h3 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .video-info p {
            color: var(--text-light);
            margin-bottom: 15px;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .video-meta {
            color: var(--text-light);
            font-size: 0.8em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* è§†é¢‘æ’­æ”¾å™¨æ ·å¼ */
        .video-player-container {
            padding: 20px;
        }

        .video-player-wrapper {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }

        .video-player {
            width: 100%;
            border-radius: 10px;
            background: #000;
            display: block;
        }

        .video-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #0DA271;
            transform: translateY(-2px);
        }

        .control-btn.secondary {
            background: var(--surface);
            color: var(--text);
            border: 2px solid #E2E8F0;
        }

        /* ç»ƒä¹ åŒºåŸŸæ ·å¼ */
        .practice-area {
            padding: 30px;
        }

        .sentence-card {
            background: var(--surface);
            border: 2px solid #E2E8F0;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .sentence-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary-light) 0%, #E6F3FF 100%);
        }

        .sentence-card.completed {
            border-color: var(--success);
            background: #F0FFF4;
        }

        .sentence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .sentence-number {
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .sentence-text {
            font-size: 1.3em;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #0DA271;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 2px solid #E2E8F0;
        }

        .btn-secondary:hover {
            background: #F7FAFC;
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        /* å½•éŸ³å’Œè¯„åˆ†ç›¸å…³æ ·å¼ */
        .recording-visual {
            text-align: center;
            margin: 20px 0;
        }

        .waveform {
            display: flex;
            align-items: end;
            justify-content: center;
            gap: 3px;
            height: 60px;
            margin: 20px 0;
        }

        .wave-bar {
            width: 4px;
            background: var(--primary);
            border-radius: 2px;
            transition: height 0.1s ease;
        }

        .recording-timer {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }

        .score-result {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            border-radius: 15px;
            background: #E0F2FE;
            border: 1px solid #0EA5E9;
        }

        .score-number {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid #E2E8F0;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            .library-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="appContainer">
        <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ¸²æŸ“ -->
    </div>

    <script>
        // åº”ç”¨çŠ¶æ€
        let currentView = 'video-library'; // 'video-library' | 'video-player' | 'practice'
        let currentVideoId = null;
        let currentSentenceIndex = 0;
        let userVideos = [];
        let currentVideoElement = null;

        // ç¤ºä¾‹é¢„è®¾è§†é¢‘æ•°æ®
        const presetVideos = [
            {
                id: 'peppa',
                title: 'ğŸ· å°çŒªä½©å¥‡ - å›½é™…æ—¥',
                description: 'é€‚åˆåˆçº§å­¦ä¹ è€…ï¼Œç®€å•å¯¹è¯ç»ƒä¹ ',
                level: 'åˆçº§',
                duration: '2:30',
                rating: '5.0',
                learners: '2.3k',
                type: 'preset',
                thumbnail: 'ğŸ·',
                videoUrl: 'https://example.com/peppa.mp4', // ç¤ºä¾‹URLï¼Œå®é™…éœ€è¦çœŸå®è§†é¢‘URL
                sentences: [
                    {
                        text: "Hello, my name is Peppa Pig.",
                        translation: "ä½ å¥½ï¼Œæˆ‘å«å°çŒªä½©å¥‡ã€‚",
                        difficulty: "easy",
                        tips: ["æ³¨æ„ 'Hello' çš„å‘éŸ³", "'Peppa' çš„é‡éŸ³åœ¨ç¬¬ä¸€ä¸ªéŸ³èŠ‚"]
                    },
                    {
                        text: "This is my little brother, George.",
                        translation: "è¿™æ˜¯æˆ‘çš„å¼Ÿå¼Ÿä¹”æ²»ã€‚",
                        difficulty: "medium",
                        tips: ["'little' çš„ /l/ å‘éŸ³è¦æ¸…æ™°", "æ³¨æ„å¥å­ä¸­çš„è¿è¯»"]
                    }
                ]
            }
        ];

        // æ¸²æŸ“åº”ç”¨
        function renderApp() {
            const container = document.getElementById('appContainer');
            
            switch (currentView) {
                case 'video-library':
                    container.innerHTML = renderVideoLibrary();
                    break;
                case 'video-player':
                    container.innerHTML = renderVideoPlayer();
                    setTimeout(initializeVideoPlayer, 0);
                    break;
                case 'practice':
                    container.innerHTML = renderPractice();
                    setTimeout(initializePractice, 0);
                    break;
            }
        }

        // æ¸²æŸ“è§†é¢‘åº“
        function renderVideoLibrary() {
            const allVideos = [...presetVideos, ...userVideos];
            
            return `
                <div class="header">
                    <h1>ğŸ¬ è‹±è¯­å­¦ä¹ è§†é¢‘åº“</h1>
                    <p>ä¸Šä¼ è§†é¢‘æˆ–é€‰æ‹©é¢„è®¾å†…å®¹å¼€å§‹è·Ÿè¯»ç»ƒä¹ </p>
                </div>
                
                <div class="video-library">
                    <div class="library-header">
                        <h2>æˆ‘çš„è§†é¢‘åº“</h2>
                        <button class="btn btn-primary" onclick="showUploadSection()">
                            ğŸ“ ä¸Šä¼ æ–°è§†é¢‘
                        </button>
                    </div>

                    <div class="upload-section" id="uploadSection" style="display: none;">
                        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                            <div class="upload-icon">ğŸ“¤</div>
                            <h3 class="upload-text">ç‚¹å‡»é€‰æ‹©è§†é¢‘æ–‡ä»¶æˆ–æ‹–æ‹½åˆ°æ­¤åŒºåŸŸ</h3>
                            <p style="color: var(--text-light); margin-bottom: 20px;">
                                æ”¯æŒ MP4, WebM, MOV æ ¼å¼ï¼Œæœ€å¤§ 100MB
                            </p>
                            <button class="btn btn-secondary">
                                ğŸ“ é€‰æ‹©è§†é¢‘æ–‡ä»¶
                            </button>
                        </div>
                        <input type="file" id="fileInput" class="file-input" accept="video/*" onchange="handleFileUpload(this.files)">
                        
                        <div id="uploadProgress" style="margin-top: 20px; display: none;">
                            <div style="background: #E2E8F0; border-radius: 10px; height: 6px;">
                                <div id="progressBar" style="background: var(--primary); height: 100%; width: 0%; border-radius: 10px; transition: width 0.3s ease;"></div>
                            </div>
                            <div id="progressText" style="text-align: center; margin-top: 10px; color: var(--text-light);"></div>
                        </div>
                    </div>

                    ${userVideos.length > 0 ? `
                        <h3 style="margin: 30px 0 20px 0;">æˆ‘çš„ä¸Šä¼ </h3>
                        <div class="video-grid">
                            ${userVideos.map(video => renderVideoCard(video)).join('')}
                        </div>
                    ` : ''}

                    <h3 style="margin: 30px 0 20px 0;">é¢„è®¾å­¦ä¹ å†…å®¹</h3>
                    <div class="video-grid">
                        ${presetVideos.map(video => renderVideoCard(video)).join('')}
                    </div>
                </div>
            `;
        }

        // æ¸²æŸ“è§†é¢‘å¡ç‰‡
        function renderVideoCard(video) {
            const thumbnailContent = video.type === 'user' && video.objectUrl ? 
                `<video muted playsinline>
                    <source src="${video.objectUrl}" type="${video.file.type}">
                </video>` : 
                `<div>${video.thumbnail}</div>`;
            
            return `
                <div class="video-card" onclick="playVideo('${video.id}')">
                    <div class="video-thumbnail">
                        ${thumbnailContent}
                        <div class="video-duration">${video.duration}</div>
                    </div>
                    <div class="video-info">
                        <h3>${video.title}</h3>
                        <p>${video.description}</p>
                        <div class="video-meta">
                            <span>â­ ${video.rating}</span>
                            <span>ğŸ“Š ${video.level}</span>
                            <span>ğŸ‘¥ ${video.learners}</span>
                        </div>
                        ${video.type === 'user' ? `
                            <div style="margin-top: 10px;">
                                <button class="btn btn-danger" onclick="event.stopPropagation(); deleteVideo('${video.id}')" style="padding: 8px 16px; font-size: 12px;">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // æ¸²æŸ“è§†é¢‘æ’­æ”¾å™¨
        function renderVideoPlayer() {
            const video = getCurrentVideo();
            if (!video) return renderVideoLibrary();

            const videoSource = video.objectUrl || video.videoUrl;

            return `
                <div class="header">
                    <h1>ğŸ¬ ${video.title}</h1>
                    <p>è§‚çœ‹è§†é¢‘å¹¶å¼€å§‹è·Ÿè¯»ç»ƒä¹ </p>
                </div>

                <div class="video-player-container">
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="goBack()">
                            â† è¿”å›è§†é¢‘åº“
                        </button>
                        <button class="btn btn-primary" onclick="startPractice()">
                            ğŸ¤ å¼€å§‹è·Ÿè¯»ç»ƒä¹ 
                        </button>
                    </div>

                    <div class="video-player-wrapper">
                        <video class="video-player" id="mainVideoPlayer" controls playsinline>
                            <source src="${videoSource}" type="video/mp4">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
                        </video>
                    </div>

                    <div class="video-controls">
                        <button class="control-btn" onclick="playPauseVideo()">
                            â¯ï¸ æ’­æ”¾/æš‚åœ
                        </button>
                        <button class="control-btn secondary" onclick="toggleMute()">
                            ğŸ”‡ é™éŸ³/å–æ¶ˆ
                        </button>
                        <button class="control-btn secondary" onclick="skipBackward()">
                            âª åé€€10ç§’
                        </button>
                        <button class="control-btn secondary" onclick="skipForward()">
                            â© å‰è¿›10ç§’
                        </button>
                        <button class="control-btn secondary" onclick="toggleFullscreen()">
                            ğŸ“º å…¨å±
                        </button>
                    </div>

                    <div style="background: #F8FAFC; padding: 20px; border-radius: 10px;">
                        <h4>ğŸ“‹ è§†é¢‘ä¿¡æ¯</h4>
                        <p style="margin-top: 10px; color: var(--text-light);">
                            <strong>æ ‡é¢˜:</strong> ${video.title}<br>
                            <strong>æè¿°:</strong> ${video.description}<br>
                            <strong>éš¾åº¦:</strong> ${video.level} | <strong>æ—¶é•¿:</strong> ${video.duration}<br>
                            <strong>è·Ÿè¯»å¥å­:</strong> ${video.sentences ? video.sentences.length : 0} å¥
                        </p>
                    </div>
                </div>
            `;
        }

        // åˆå§‹åŒ–è§†é¢‘æ’­æ”¾å™¨
        function initializeVideoPlayer() {
            currentVideoElement = document.getElementById('mainVideoPlayer');
            if (currentVideoElement) {
                // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                currentVideoElement.addEventListener('loadedmetadata', function() {
                    console.log('è§†é¢‘æ—¶é•¿:', this.duration);
                });
                
                currentVideoElement.addEventListener('timeupdate', function() {
                    updateVideoProgress();
                });
            }
        }

        // è§†é¢‘æ§åˆ¶å‡½æ•°
        function playPauseVideo() {
            if (currentVideoElement) {
                if (currentVideoElement.paused) {
                    currentVideoElement.play();
                } else {
                    currentVideoElement.pause();
                }
            }
        }

        function toggleMute() {
            if (currentVideoElement) {
                currentVideoElement.muted = !currentVideoElement.muted;
            }
        }

        function skipBackward() {
            if (currentVideoElement) {
                currentVideoElement.currentTime = Math.max(0, currentVideoElement.currentTime - 10);
            }
        }

        function skipForward() {
            if (currentVideoElement) {
                currentVideoElement.currentTime = Math.min(currentVideoElement.duration, currentVideoElement.currentTime + 10);
            }
        }

        function toggleFullscreen() {
            if (currentVideoElement) {
                if (!document.fullscreenElement) {
                    currentVideoElement.requestFullscreen().catch(err => {
                        console.log(`å…¨å±è¯·æ±‚å¤±è´¥: ${err.message}`);
                    });
                } else {
                    document.exitFullscreen();
                }
            }
        }

        function updateVideoProgress() {
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è¿›åº¦æ›´æ–°é€»è¾‘
        }

        // è§†é¢‘ç®¡ç†åŠŸèƒ½
        function showUploadSection() {
            const uploadSection = document.getElementById('uploadSection');
            uploadSection.style.display = uploadSection.style.display === 'none' ? 'block' : 'none';
        }

        function handleFileUpload(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            if (!file.type.startsWith('video/')) {
                alert('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼');
                return;
            }

            // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
            const progressSection = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressSection.style.display = 'block';
            
            // æ¨¡æ‹Ÿä¸Šä¼ è¿‡ç¨‹
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    // åˆ›å»ºå¯¹è±¡URLç”¨äºæœ¬åœ°æ’­æ”¾
                    const objectUrl = URL.createObjectURL(file);
                    
                    // åˆ›å»ºæ–°è§†é¢‘å¯¹è±¡
                    const newVideo = {
                        id: 'user_' + Date.now(),
                        title: file.name.replace(/\.[^/.]+$/, ""), // ç§»é™¤æ‰©å±•å
                        description: 'æˆ‘ä¸Šä¼ çš„å­¦ä¹ è§†é¢‘',
                        level: 'è‡ªå®šä¹‰',
                        duration: 'å¾…åˆ†æ',
                        rating: '5.0',
                        learners: '1',
                        type: 'user',
                        thumbnail: 'ğŸ¥',
                        objectUrl: objectUrl,
                        file: file,
                        sentences: [
                            {
                                text: "This is a sample sentence from your video.",
                                translation: "è¿™æ˜¯æ¥è‡ªæ‚¨è§†é¢‘çš„ç¤ºä¾‹å¥å­ã€‚",
                                difficulty: "medium",
                                tips: ["æ³¨æ„å‘éŸ³æ¸…æ™°", "ä¿æŒè‡ªç„¶è¯­è°ƒ"]
                            },
                            {
                                text: "Learning English is fun and rewarding.",
                                translation: "å­¦ä¹ è‹±è¯­æ—¢æœ‰è¶£åˆæœ‰æ”¶è·ã€‚",
                                difficulty: "easy",
                                tips: ["æ³¨æ„è¯­è°ƒå˜åŒ–", "ä¿æŒæµç•…åº¦"]
                            }
                        ]
                    };
                    
                    userVideos.push(newVideo);
                    progressText.innerHTML = 'âœ… ä¸Šä¼ å®Œæˆï¼';
                    
                    setTimeout(() => {
                        renderApp();
                        alert('è§†é¢‘ä¸Šä¼ æˆåŠŸï¼ç°åœ¨æ‚¨å¯ä»¥æ’­æ”¾è§†é¢‘å¹¶å¼€å§‹è·Ÿè¯»ç»ƒä¹ ã€‚');
                    }, 1000);
                }
                
                progressBar.style.width = progress + '%';
                progressText.innerHTML = `ä¸Šä¼ ä¸­... ${Math.round(progress)}%`;
            }, 200);
        }

        function deleteVideo(videoId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè§†é¢‘å—ï¼Ÿ')) {
                const videoIndex = userVideos.findIndex(video => video.id === videoId);
                if (videoIndex !== -1) {
                    // é‡Šæ”¾å¯¹è±¡URL
                    if (userVideos[videoIndex].objectUrl) {
                        URL.revokeObjectURL(userVideos[videoIndex].objectUrl);
                    }
                    userVideos.splice(videoIndex, 1);
                }
                renderApp();
            }
        }

        // è§†é¢‘æ’­æ”¾åŠŸèƒ½
        function playVideo(videoId) {
            currentVideoId = videoId;
            currentView = 'video-player';
            renderApp();
        }

        function getCurrentVideo() {
            const allVideos = [...presetVideos, ...userVideos];
            return allVideos.find(video => video.id === currentVideoId);
        }

        function startPractice() {
            currentView = 'practice';
            currentSentenceIndex = 0;
            renderApp();
        }

        function goBackToVideo() {
            currentView = 'video-player';
            renderApp();
        }

        // å¯¼èˆªåŠŸèƒ½
        function goBack() {
            if (currentView === 'video-player') {
                currentView = 'video-library';
            } else if (currentView === 'practice') {
                if (confirm('ç¡®å®šè¦è¿”å›å—ï¼Ÿå½“å‰ç»ƒä¹ è¿›åº¦å°†ä¸ä¼šä¿å­˜ã€‚')) {
                    currentView = 'video-player';
                }
            }
            renderApp();
        }

        // ç»ƒä¹ åŠŸèƒ½å®ç°
        function renderPractice() {
            const video = getCurrentVideo();
            return `
                <div class="header">
                    <h1>ğŸ¤ è‹±è¯­è·Ÿè¯»ç»ƒä¹ </h1>
                    <p>${video ? video.title : 'è·Ÿè¯»ç»ƒä¹ '}</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div id="progressText">0/0 å¥å®Œæˆ</div>
                </div>

                <div class="practice-area">
                    <div id="sentencesContainer"></div>
                    <div class="recording-visual" id="recordingVisual" style="display: none;">
                        <div class="waveform" id="waveform"></div>
                        <div class="recording-timer" id="recordingTimer">00:00</div>
                        <div style="text-align: center; padding: 15px; margin: 15px 0; border-radius: 10px; background: #FEF3C7; border: 1px solid var(--warning); color: var(--warning);">
                            â— æ­£åœ¨å½•éŸ³ä¸­... ç‚¹å‡»"ç»“æŸæœ—è¯»"å®Œæˆå½•éŸ³
                        </div>
                        <button class="btn btn-primary" id="stopRecordingBtn">
                            â¹ï¸ ç»“æŸæœ—è¯»
                        </button>
                    </div>
                    <div class="score-result" id="scoreResult" style="display: none;">
                        <h3>ğŸ¯ å‘éŸ³è¯„åˆ†</h3>
                        <div class="score-number" id="scoreNumber">0</div>
                        <div class="feedback" id="scoreFeedback"></div>
                        <div style="background: #F8FAFC; border-radius: 10px; padding: 15px; margin: 15px 0; text-align: left;">
                            <h4>ğŸ’¡ å‘éŸ³å»ºè®®</h4>
                            <div id="pronunciationTips"></div>
                        </div>
                        <button class="btn btn-primary" onclick="nextSentence()">
                            â¡ï¸ ä¸‹ä¸€å¥
                        </button>
                        <button class="btn btn-secondary" onclick="repeatSentence()" style="margin-top: 10px;">
                            ğŸ”„ é‡å¤ç»ƒä¹ æ­¤å¥
                        </button>
                    </div>
                </div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="goBackToVideo()">
                        â† è¿”å›è§†é¢‘
                    </button>
                    <button class="btn btn-primary" id="completeBtn" style="display: none;">
                        âœ… å®Œæˆç»ƒä¹ 
                    </button>
                </div>
            `;
        }

        function initializePractice() {
            renderSentences();
            updateProgress();
            createWaveform();
            document.getElementById('stopRecordingBtn').addEventListener('click', stopRecording);
        }

        function renderSentences() {
            const video = getCurrentVideo();
            if (!video || !video.sentences) return;
            
            const container = document.getElementById('sentencesContainer');
            let html = video.sentences.map((sentence, index) => `
                <div class="sentence-card ${index === currentSentenceIndex ? 'active' : ''} ${index < currentSentenceIndex ? 'completed' : ''}" 
                     id="sentence-${index}" ${index === currentSentenceIndex ? '' : 'style="display: none;"'}>
                    <div class="sentence-header">
                        <div class="sentence-number">${index + 1}</div>
                        <div style="color: var(--text-light); font-size: 0.9em;">
                            ${sentence.difficulty === 'easy' ? 'â­ ç®€å•' : sentence.difficulty === 'medium' ? 'â­â­ ä¸­ç­‰' : 'â­â­â­ å›°éš¾'}
                        </div>
                    </div>
                    <div class="sentence-text">
                        ${sentence.text}
                        <div style="font-size: 0.8em; color: var(--text-light); margin-top: 8px;">
                            ${sentence.translation}
                        </div>
                    </div>
                    <div class="sentence-actions">
                        <button class="btn btn-secondary" onclick="playDemonstration(${index})">
                            ğŸ”Š AIæœ—è¯»ç¤ºèŒƒ
                        </button>
                        <button class="btn btn-primary" onclick="startRecording(${index})" id="recordBtn-${index}">
                            ğŸ¤ å¼€å§‹æœ—è¯»
                        </button>
                    </div>
                    <div style="background: #F8FAFC; border-radius: 10px; padding: 15px; margin: 15px 0; text-align: left;">
                        <h4>ğŸ“ å‘éŸ³è¦ç‚¹</h4>
                        ${sentence.tips.map(tip => `
                            <div style="display: flex; align-items: center; margin: 8px 0; font-size: 0.9em;">
                                <span style="margin-right: 10px; font-size: 1.2em;">â€¢</span>
                                <span>${tip}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            container.innerHTML = html;
        }

        // ç»ƒä¹ åŠŸèƒ½å®ç°
        let isRecording = false;
        let recordingTimer = null;
        let recordingSeconds = 0;
        let waveAnimation = null;

        function startRecording(index) {
            if (isRecording) return;
            
            isRecording = true;
            currentSentenceIndex = index;
            
            document.getElementById(`recordBtn-${index}`).style.display = 'none';
            document.getElementById('recordingVisual').style.display = 'block';
            
            // å¼€å§‹è®¡æ—¶
            recordingSeconds = 0;
            recordingTimer = setInterval(() => {
                recordingSeconds++;
                const minutes = Math.floor(recordingSeconds / 60);
                const seconds = recordingSeconds % 60;
                document.getElementById('recordingTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
            
            // å¼€å§‹å£°æ³¢çº¹åŠ¨ç”»
            startWaveAnimation();
        }

        function stopRecording() {
            if (!isRecording) return;
            
            isRecording = false;
            
            // åœæ­¢è®¡æ—¶å’ŒåŠ¨ç”»
            if (recordingTimer) {
                clearInterval(recordingTimer);
                recordingTimer = null;
            }
            stopWaveAnimation();
            
            document.getElementById('recordingVisual').style.display = 'none';
            
            // æ¨¡æ‹Ÿåˆ†æè¿‡ç¨‹
            setTimeout(() => {
                showScoreResult();
            }, 1500);
        }

        function startWaveAnimation() {
            const bars = document.querySelectorAll('.wave-bar');
            waveAnimation = setInterval(() => {
                bars.forEach(bar => {
                    const randomHeight = Math.random() * 50 + 10;
                    bar.style.height = `${randomHeight}px`;
                    bar.style.background = `hsl(${Math.random() * 60 + 180}, 70%, 60%)`;
                });
            }, 100);
        }

        function stopWaveAnimation() {
            if (waveAnimation) {
                clearInterval(waveAnimation);
                waveAnimation = null;
            }
            
            const bars = document.querySelectorAll('.wave-bar');
            bars.forEach(bar => {
                bar.style.height = '10px';
                bar.style.background = 'var(--primary)';
            });
        }

        function showScoreResult() {
            const video = getCurrentVideo();
            const currentSentence = video.sentences[currentSentenceIndex];
            const score = Math.floor(Math.random() * 25) + 70;
            
            document.getElementById('scoreNumber').textContent = score;
            document.getElementById('scoreNumber').className = `score-number ${
                score >= 90 ? 'score-excellent' : 
                score >= 80 ? 'score-good' : 'score-poor'
            }`;
            
            document.getElementById('scoreFeedback').innerHTML = score >= 90 ? 
                'ğŸ‰ å¤ªæ£’äº†ï¼å‘éŸ³éå¸¸æ ‡å‡†ï¼' : 
                score >= 80 ? 'ğŸ‘ å¾ˆå¥½ï¼ç»§ç»­åŠªåŠ›ï¼' : 'ğŸ’ª ä¸é”™ï¼å¤šç»ƒä¹ ä¼šæœ‰æ›´å¤§è¿›æ­¥ï¼';
            
            const tipsHtml = currentSentence.tips.map(tip => `
                <div style="display: flex; align-items: center; margin: 8px 0; font-size: 0.9em;">
                    <span style="margin-right: 10px; font-size: 1.2em;">â€¢</span>
                    <span>${tip}</span>
                </div>
            `).join('');
            
            document.getElementById('pronunciationTips').innerHTML = tipsHtml;
            document.getElementById('scoreResult').style.display = 'block';
            updateProgress();
        }

        function nextSentence() {
            document.getElementById('scoreResult').style.display = 'none';
            
            const currentCard = document.getElementById(`sentence-${currentSentenceIndex}`);
            currentCard.classList.remove('active');
            currentCard.classList.add('completed');
            currentCard.style.display = 'none';
            
            currentSentenceIndex++;
            
            const video = getCurrentVideo();
            if (currentSentenceIndex < video.sentences.length) {
                const nextCard = document.getElementById(`sentence-${currentSentenceIndex}`);
                nextCard.classList.add('active');
                nextCard.style.display = 'block';
                document.getElementById(`recordBtn-${currentSentenceIndex}`).style.display = 'flex';
            } else {
                showCompletion();
            }
            
            updateProgress();
        }

        function repeatSentence() {
            document.getElementById('scoreResult').style.display = 'none';
            document.getElementById(`recordBtn-${currentSentenceIndex}`).style.display = 'flex';
        }

        function playDemonstration(index) {
            const video = getCurrentVideo();
            alert(`AIæœ—è¯»ç¤ºèŒƒ: "${video.sentences[index].text}"`);
        }

        function createWaveform() {
            const waveform = document.getElementById('waveform');
            waveform.innerHTML = Array.from({length: 50}, () => 
                '<div class="wave-bar" style="height: 10px;"></div>'
            ).join('');
        }

        function updateProgress() {
            const video = getCurrentVideo();
            const progress = (currentSentenceIndex / video.sentences.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = 
                `${currentSentenceIndex}/${video.sentences.length} å¥å®Œæˆ`;
        }

        function showCompletion() {
            const container = document.getElementById('sentencesContainer');
            const totalScore = Math.floor(Math.random() * 20) + 80;
            const video = getCurrentVideo();
            
            container.innerHTML = `
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ‰</div>
                    <h2>ç»ƒä¹ å®Œæˆï¼</h2>
                    <div style="font-size: 3em; font-weight: bold; color: var(--primary); margin: 20px 0;">
                        ${totalScore}åˆ†
                    </div>
                    <p style="color: var(--text-light); margin-bottom: 30px;">
                        æ‚¨å®Œæˆäº† ${video.sentences.length} å¥è·Ÿè¯»ç»ƒä¹ 
                    </p>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="restartPractice()">
                            ğŸ”„ é‡æ–°ç»ƒä¹ 
                        </button>
                        <button class="btn btn-secondary" onclick="goBackToVideo()">
                            ğŸ“š è¿”å›è§†é¢‘
                        </button>
                    </div>
                </div>
            `;
        }

        function restartPractice() {
            currentSentenceIndex = 0;
            initializePractice();
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', renderApp);
    </script>
</body>
</html>
